(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{779:function(s,a,t){"use strict";t.r(a);var e=t(108),n=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"模块打包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#模块打包"}},[s._v("#")]),s._v(" 模块打包")]),s._v(" "),t("p",[s._v("从 2.5 版本起，炸毛框架的模块源码支持了打包和分发，开发者可以通过将自己的功能编写打包，并通过互联网进行分发，供其他人使用。此外，还提供了模块包热加载（不解包直接运行）和模块包解包功能。")]),s._v(" "),t("h2",{attrs:{id:"构建模块包配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#构建模块包配置文件"}},[s._v("#")]),s._v(" 构建模块包配置文件")]),s._v(" "),t("p",[s._v("炸毛框架的模块区分是根据 "),t("code",[s._v("src")]),s._v(" 目录下的文件夹定义的，模块包的配置文件命名必须为 "),t("code",[s._v("zm.json")]),s._v("，此外，假设我们编写了一个最简单的模块，以脚手架生成的 Example 模块为例，文件夹结构如下：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("src/\n└── Module/\n    ├── Example/\n    │   ├── Hello.php\n    │   └── zm.json\n    └── Middleware/\n        └── TimerMiddleware.php\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("我们在 Example 目录下创建一个 "),t("code",[s._v("zm.json")]),s._v(" 的文件，编写配置，即代表 "),t("code",[s._v("src/Module/Example/")]),s._v(" 文件夹及里面的用户模块源码为一个模块包，也就可以被框架识别并打包处理。")]),s._v(" "),t("p",[s._v("编写的配置文件结构如下：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('{\n\t"name": "my-first-module"\n}\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("对！你没看错，只需要定义一个 "),t("code",[s._v("name")]),s._v(" 字段，即可声明这是一个模块包！")]),s._v(" "),t("h3",{attrs:{id:"配置文件参数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置文件参数"}},[s._v("#")]),s._v(" 配置文件参数")]),s._v(" "),t("h4",{attrs:{id:"description"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#description"}},[s._v("#")]),s._v(" - description")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("类型："),t("code",[s._v("string")]),s._v("。")])]),s._v(" "),t("li",[t("p",[s._v("含义：模块的描述。")])])]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("编写实例")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-first-module"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"description"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"这个是一个示例模块打包教程"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])])]),s._v(" "),t("h4",{attrs:{id:"version"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#version"}},[s._v("#")]),s._v(" - version")]),s._v(" "),t("ul",[t("li",[s._v("类型：string。")]),s._v(" "),t("li",[s._v("含义：模块的版本。")])]),s._v(" "),t("p",[s._v("版本处理方式和 Composer 基本一致，建议使用三段式，也就是 "),t("code",[s._v("大版本.小版本.补丁版本")]),s._v("。关于三段式版本的描述和规范，见 "),t("a",{attrs:{href:"https://www.chrisyue.com/what-the-hell-are-semver-and-the-difference-between-composer-version-control-sign-tilde-and-caret.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("到底三段式版本号是什么？"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("编写实例")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"my-first-module"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"description"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"这个是一个示例模块打包教程"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"version"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.0.0"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])])]),s._v(" "),t("h4",{attrs:{id:"depends"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#depends"}},[s._v("#")]),s._v(" - depends")]),s._v(" "),t("ul",[t("li",[s._v("类型：map of string（例如 "),t("code",[s._v('{"foo":"bar","baz":"zoo"}')]),s._v("）。")]),s._v(" "),t("li",[s._v("含义：模块的依赖关系和版本依赖声明。")])]),s._v(" "),t("p",[s._v("此处用作模块的依赖检测，假设模块 "),t("code",[s._v("foo")]),s._v(" 依赖模块 "),t("code",[s._v("bar")]),s._v(" 的 1.x 版本但是不兼容 "),t("code",[s._v("bar")]),s._v(" 的 2.x 版本，可以像 Composer 的 "),t("code",[s._v("require")]),s._v(" 一样编写版本依赖："),t("code",[s._v("^1.0")]),s._v("。也可以使用 "),t("code",[s._v("~")]),s._v("、"),t("code",[s._v(">=")]),s._v("、"),t("code",[s._v("*")]),s._v(" 这些与 Composer 包管理相同逻辑的版本依赖关系，详见 "),t("a",{attrs:{href:"https://docs.phpcomposer.com/01-basic-usage.html#Package-Versions",target:"_blank",rel:"noopener noreferrer"}},[s._v("Composer - 包版本"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("编写实例")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"foo"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"description"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"这个是一个示例模块打包教程"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"depends"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"bar"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^1.0"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"bsr"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*"')]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])])]),s._v(" "),t("h4",{attrs:{id:"light-cache-store"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#light-cache-store"}},[s._v("#")]),s._v(" - light-cache-store")]),s._v(" "),t("ul",[t("li",[s._v("类型：array of string（例如 "),t("code",[s._v('["foo","bar"]')]),s._v("）。")]),s._v(" "),t("li",[s._v("含义：打包模块时要储存的持久化 LightCache 键名列表。")])]),s._v(" "),t("p",[s._v("这里需要配合 LightCache 使用，如果你有一些需要全局缓存的数据，例如动态配置项，比如群服务状态列表，可以先使用 LightCache 存储并使用 "),t("code",[s._v("addPersistence()")]),s._v(" 持久化，此后在使用模块打包时编写此配置项。")]),s._v(" "),t("p",[s._v("我们假设在项目模块中使用到了 "),t("code",[s._v("group-status")]),s._v(" 这一个 LightCache，那么只需要写 "),t("code",[s._v("light-cache-store")]),s._v(" 配置项，在模块打包时就会将持久化的数据也打包到 phar 模块包内。")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("编写实例")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"foo"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"description"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"这个是一个示例模块打包教程"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"light-cache-store"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"group-status"')]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])])]),s._v(" "),t("h4",{attrs:{id:"global-config-override"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#global-config-override"}},[s._v("#")]),s._v(" - global-config-override")]),s._v(" "),t("ul",[t("li",[s._v("类型：string | false。")]),s._v(" "),t("li",[s._v("含义：解包时是否需要手动编辑全局配置（"),t("code",[s._v("global.php")]),s._v("）。")])]),s._v(" "),t("p",[s._v("这里如果写 string 类型的，那么就是相当于在解包时会提示此处的内容，内容推荐填写要求解包模块用户需要编辑的项目，比如 「请将 static_file_server 的 status 改为 true，以便使用静态文本功能」。")]),s._v(" "),t("p",[s._v("如果是 false，那么和不指定此参数效果是一样的，无需用户修改 global.php。")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("编写实例")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"foo"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"description"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"这个是一个示例模块打包教程"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"global-config-override"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"请将 static_file_server 的 status 改为 true"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])])]),s._v(" "),t("h4",{attrs:{id:"allow-hotload"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#allow-hotload"}},[s._v("#")]),s._v(" - allow-hotload")]),s._v(" "),t("ul",[t("li",[s._v("类型：bool。")]),s._v(" "),t("li",[s._v("含义：是否允许用户无需解压直接加载模块包文件（phar）。")])]),s._v(" "),t("p",[s._v("当此项为 true 时，可以将模块包直接放入 "),t("code",[s._v("zm_data/modules")]),s._v(" 文件夹下，然后将 "),t("code",[s._v("global.php")]),s._v(" 中的 "),t("code",[s._v("module_loader")]),s._v(" 项中的 "),t("code",[s._v("enable_hotload")]),s._v(" 改为 true，启动框架即可加载。")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("编写实例")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"foo"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"description"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"这个是一个示例模块打包教程"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"allow-hotload"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])])]),s._v(" "),t("div",{staticClass:"custom-block warning"},[t("p",{staticClass:"custom-block-title"},[s._v("注意")]),s._v(" "),t("p",[s._v("如果使用允许热加载，那么模块包中的配置最好不要有 "),t("code",[s._v("global-config-override")]),s._v(" 和 "),t("code",[s._v("light-cache-store")]),s._v("，以此来达到最正确的效果，一般热加载更适合 Library（库）类型的模块。")])]),s._v(" "),t("h4",{attrs:{id:"zm-data-store"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#zm-data-store"}},[s._v("#")]),s._v(" - zm-data-store")]),s._v(" "),t("ul",[t("li",[s._v("类型：array of string（例如 "),t("code",[s._v('["foo","bar"]')]),s._v("）。")]),s._v(" "),t("li",[s._v("含义：打包时要添加到模块包内的 "),t("code",[s._v("zm_data")]),s._v(" 目录下的子目录或文件。")])]),s._v(" "),t("p",[s._v("其中项目必须是相对路径，不能是绝对路径，且必须是在配置项 "),t("code",[s._v("zm_data")]),s._v(" 指定的目录（默认会在框架项目的根目录下的 "),t("code",[s._v("zm_data/")]),s._v(" 目录。")]),s._v(" "),t("p",[s._v("我们假设要打包一个 "),t("code",[s._v("{zm_data 目录}/config/")]),s._v(" 目录及其目录下的文件，和一个 "),t("code",[s._v("main.png")]),s._v(" 文件，下方是实例。")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("编写实例")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"foo"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"description"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"这个是一个示例模块打包教程"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"zm-data-store"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"config/"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"main.png"')]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])])]),s._v(" "),t("p",[s._v("在打包时框架会自动添加这些文件到 phar 插件包内，到解包时，会自动将这些文件释放到对应框架的 "),t("code",[s._v("zm_data")]),s._v(" 目录下。")]),s._v(" "),t("h2",{attrs:{id:"打包模块命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#打包模块命令"}},[s._v("#")]),s._v(" 打包模块命令")]),s._v(" "),t("p",[s._v("编写配置文件 "),t("code",[s._v("zm.json")]),s._v(" 后，就可以被框架正常识别为模块形式，你也可以使用对无需打包的模块进行配置以进行分类管理。")]),s._v(" "),t("h3",{attrs:{id:"module-list"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#module-list"}},[s._v("#")]),s._v(" module:list")]),s._v(" "),t("p",[s._v("使用 list 命令可以列出炸毛框架检测到配置文件或打包好的模块。")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("$ ./zhamao module:list\n[foo]\n        类型: source\n        版本: 1.0.0\n        描述: 示例模块打包文件\n        目录: src/Module/Example\n没有发现已打包且装载的模块！\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("其中 "),t("code",[s._v("[ ]")]),s._v(" 内为识别出来的模块名称，由上方用户编写的 "),t("code",[s._v("zm.json")]),s._v(" 定义，类型为 "),t("code",[s._v("source")]),s._v(" 是源码形式，也就是指定了 "),t("code",[s._v("zm.json")]),s._v(" 形式的模块，目录为模块所在子目录。")]),s._v(" "),t("p",[s._v("我们假设打包上方定义的 "),t("code",[s._v("foo")]),s._v(" 模块，使用下方命令 "),t("code",[s._v("module:pack")]),s._v(" 即可。")]),s._v(" "),t("h3",{attrs:{id:"module-pack"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#module-pack"}},[s._v("#")]),s._v(" module:pack")]),s._v(" "),t("p",[s._v("使用 pack 命令可以将配置好的模块打包为 "),t("code",[s._v("xxx.phar")]),s._v(" 文件并转移或发布给他人。")]),s._v(" "),t("p",[s._v("我们假设打包模块脚手架的默认模块 "),t("code",[s._v("src/Module/Example")]),s._v(" 下面的模块源码和附带一个 "),t("code",[s._v("zm_data")]),s._v(" 目录下的文件（我们就随便打包一下 Swoole 的输出日志吧）。"),t("code",[s._v("zm.json")]),s._v(" 文件内容如下：")]),s._v(" "),t("div",{staticClass:"language-json line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"foo"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"description"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"示例模块打包文件"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"version"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.0.0"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"allow-hotload"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"zm-data-store"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"crash/swoole_error.log"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[s._v("然后输入命令：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("$ ./zhamao module:pack foo\n[15:07:11] [I] 模块输出文件：/root/zhamao-framework/zm_data/output/foo_1.0.0.phar\n[15:07:11] [S] 打包完成！\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("如果提示文件夹不存在，请先手动创建文件夹："),t("code",[s._v("mkdir /path/to/your/zm_data/output")])]),s._v(" "),t("p",[s._v("在打包后，你将获得一个 "),t("code",[s._v("foo_1.0.0.phar")]),s._v(" 的文件。")]),s._v(" "),t("blockquote",[t("p",[s._v("如果你没有在 "),t("code",[s._v("zm.json")]),s._v(" 中指定 "),t("code",[s._v("version")]),s._v("，那么输出的 phar 文件是不会带版本号的。")])]),s._v(" "),t("p",[s._v("打包后的 phar 内将包含：")]),s._v(" "),t("ul",[t("li",[s._v("Hello.php")]),s._v(" "),t("li",[s._v("zm.json")]),s._v(" "),t("li",[s._v("crash/swoole_error.log")]),s._v(" "),t("li",[s._v("必要的框架热加载以及解包需要的配置信息")])]),s._v(" "),t("h2",{attrs:{id:"打包命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#打包命令"}},[s._v("#")]),s._v(" 打包命令")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./zhamao 和原先的 vendor/bin/start 是完全一致的")]),s._v("\n./zhamao module:pack "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("module-name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("例如，打包上面的名叫 foo 的模块："),t("code",[s._v("./zhamao module:pack foo")]),s._v("。")]),s._v(" "),t("p",[s._v("打包命令执行后，将会在 "),t("code",[s._v("zm_data")]),s._v(" 下的 "),t("code",[s._v("output")]),s._v(" 目录输出一个 phar 文件。如果你指定了 "),t("code",[s._v("version")]),s._v(" 参数，那么文件名将会是 "),t("code",[s._v("${name}_${version}.phar")]),s._v("，如果没有指定版本，那么只会有 "),t("code",[s._v("${name}.phar")]),s._v("，同时如果文件已经存在，将覆盖写入。")]),s._v(" "),t("h2",{attrs:{id:"查看模块信息命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看模块信息命令"}},[s._v("#")]),s._v(" 查看模块信息命令")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("./zhamao module:list\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("通过此命令可以查看模块相关的信息，如未打包但已配置的模块信息等。")])])}),[],!1,null,null,null);a.default=n.exports}}]);