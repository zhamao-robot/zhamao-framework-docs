(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{790:function(t,s,a){"use strict";a.r(s);var n=a(108),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"框架核心注解事件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#框架核心注解事件"}},[t._v("#")]),t._v(" 框架核心注解事件")]),t._v(" "),a("p",[t._v("框架核心注解事件区别于机器人和路由注解事件，这里框架注解事件都是"),a("strong",[t._v("直接")]),t._v("或封装调用 Swoole 的回调事件的，所以对一些比较底层或者基础的操作都在这里做，例如收到 HTTP 或 WebSocket 连接后执行的事件函数。")]),t._v(" "),a("h2",{attrs:{id:"onopenevent"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#onopenevent"}},[t._v("#")]),t._v(" OnOpenEvent()")]),t._v(" "),a("p",[t._v("当有 WebSocket 连接接入框架时，触发注解事件。")]),t._v(" "),a("h3",{attrs:{id:"属性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#属性"}},[t._v("#")]),t._v(" 属性")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("值")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("名称")]),t._v(" "),a("td",[a("code",[t._v("@OnOpenEvent")])])]),t._v(" "),a("tr",[a("td",[t._v("触发前提")]),t._v(" "),a("td",[t._v("当有 WebSocket 连接接入框架时，触发注解事件")])]),t._v(" "),a("tr",[a("td",[t._v("命名空间")]),t._v(" "),a("td",[a("code",[t._v("ZM\\Annotation\\Swoole\\OnOpenEvent")])])]),t._v(" "),a("tr",[a("td",[t._v("适用位置")]),t._v(" "),a("td",[t._v("方法")])]),t._v(" "),a("tr",[a("td",[t._v("返回值处理")]),t._v(" "),a("td",[t._v("无")])])])]),t._v(" "),a("h3",{attrs:{id:"参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参数"}},[t._v("#")]),t._v(" 参数")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数名称")]),t._v(" "),a("th",[t._v("参数范围")]),t._v(" "),a("th",[t._v("用途")]),t._v(" "),a("th",[t._v("默认")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("connect_type")]),t._v(" "),a("td",[a("code",[t._v("string")])]),t._v(" "),a("td",[t._v("限定连接的类型，通过炸毛框架支持的方式指定传入类型，详见 "),a("a",{attrs:{href:"/advanced/connect-ws-client"}},[t._v("进阶 - 接入 WebSocket 客户端")])]),t._v(" "),a("td")])])]),t._v(" "),a("h3",{attrs:{id:"用法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用法"}},[t._v("#")]),t._v(" 用法")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@OnOpenEvent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"foo"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@OnOpenEvent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("connect_type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("h3",{attrs:{id:"事件绑定参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件绑定参数"}},[t._v("#")]),t._v(" 事件绑定参数")]),t._v(" "),a("p",[a("code",[t._v("$conn")]),t._v(": "),a("RouterLink",{attrs:{to:"/advanced/connect-ws-client/"}},[t._v("ConnectionObject")]),t._v(" 类型，返回一个当前 WS 连接的连接对象。")],1),t._v(" "),a("h2",{attrs:{id:"oncloseevent"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#oncloseevent"}},[t._v("#")]),t._v(" OnCloseEvent()")]),t._v(" "),a("p",[t._v("当有 WebSocket 连接断开框架时，触发注解事件。")]),t._v(" "),a("h3",{attrs:{id:"属性-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#属性-2"}},[t._v("#")]),t._v(" 属性")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("值")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("名称")]),t._v(" "),a("td",[a("code",[t._v("@OnCloseEvent")])])]),t._v(" "),a("tr",[a("td",[t._v("触发前提")]),t._v(" "),a("td",[t._v("当有 WebSocket 连接断开框架时，触发注解事件")])]),t._v(" "),a("tr",[a("td",[t._v("命名空间")]),t._v(" "),a("td",[a("code",[t._v("ZM\\Annotation\\Swoole\\OnCloseEvent")])])]),t._v(" "),a("tr",[a("td",[t._v("适用位置")]),t._v(" "),a("td",[t._v("方法")])]),t._v(" "),a("tr",[a("td",[t._v("返回值处理")]),t._v(" "),a("td",[t._v("无")])])])]),t._v(" "),a("h3",{attrs:{id:"参数-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参数-2"}},[t._v("#")]),t._v(" 参数")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数名称")]),t._v(" "),a("th",[t._v("参数范围")]),t._v(" "),a("th",[t._v("用途")]),t._v(" "),a("th",[t._v("默认")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("connect_type")]),t._v(" "),a("td",[a("code",[t._v("string")])]),t._v(" "),a("td",[t._v("限定连接的类型，通过炸毛框架支持的方式指定传入类型，详见 "),a("a",{attrs:{href:"/advanced/connect-ws-client"}},[t._v("进阶 - 接入 WebSocket 客户端")])]),t._v(" "),a("td")])])]),t._v(" "),a("h3",{attrs:{id:"用法-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用法-2"}},[t._v("#")]),t._v(" 用法")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@OnCloseEvent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"foo"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@OnCloseEvent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("connect_type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("h3",{attrs:{id:"事件绑定参数-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件绑定参数-2"}},[t._v("#")]),t._v(" 事件绑定参数")]),t._v(" "),a("p",[a("code",[t._v("$conn")]),t._v(": "),a("RouterLink",{attrs:{to:"/advanced/connect-ws-client/"}},[t._v("ConnectionObject")]),t._v(" 类型，返回一个当前 WS 连接的连接对象。")],1),t._v(" "),a("h2",{attrs:{id:"onrequestevent"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#onrequestevent"}},[t._v("#")]),t._v(" OnRequestEvent()")]),t._v(" "),a("p",[t._v("当 HTTP 请求接入时，触发注解事件。")]),t._v(" "),a("h3",{attrs:{id:"属性-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#属性-3"}},[t._v("#")]),t._v(" 属性")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("值")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("名称")]),t._v(" "),a("td",[a("code",[t._v("@OnRequestEvent")])])]),t._v(" "),a("tr",[a("td",[t._v("触发前提")]),t._v(" "),a("td",[t._v("当 HTTP 请求接入时，触发注解事件")])]),t._v(" "),a("tr",[a("td",[t._v("命名空间")]),t._v(" "),a("td",[a("code",[t._v("ZM\\Annotation\\Swoole\\OnRequestEvent")])])]),t._v(" "),a("tr",[a("td",[t._v("适用位置")]),t._v(" "),a("td",[t._v("方法")])]),t._v(" "),a("tr",[a("td",[t._v("返回值处理")]),t._v(" "),a("td",[t._v("无")])])])]),t._v(" "),a("h3",{attrs:{id:"参数-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参数-3"}},[t._v("#")]),t._v(" 参数")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数名称")]),t._v(" "),a("th",[t._v("参数范围")]),t._v(" "),a("th",[t._v("用途")]),t._v(" "),a("th",[t._v("默认")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("rule")]),t._v(" "),a("td",[a("code",[t._v("string")]),t._v("，必须是可执行且返回 bool 的 PHP 代码")]),t._v(" "),a("td",[t._v("前置条件")]),t._v(" "),a("td",[t._v("空，rule 为 true")])]),t._v(" "),a("tr",[a("td",[t._v("level")]),t._v(" "),a("td",[a("code",[t._v("int")])]),t._v(" "),a("td",[t._v("事件优先级（越大越靠前）")]),t._v(" "),a("td",[t._v("20")])])])]),t._v(" "),a("h2",{attrs:{id:"onmessageevent"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#onmessageevent"}},[t._v("#")]),t._v(" OnMessageEvent()")]),t._v(" "),a("p",[t._v("当有 WebSocket 连接接入框架后发送过来消息，触发注解事件。")]),t._v(" "),a("h3",{attrs:{id:"属性-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#属性-4"}},[t._v("#")]),t._v(" 属性")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("值")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("名称")]),t._v(" "),a("td",[a("code",[t._v("@OnMessageEvent")])])]),t._v(" "),a("tr",[a("td",[t._v("触发前提")]),t._v(" "),a("td",[t._v("当有 WebSocket 连接接入框架后发送过来消息，触发注解事件")])]),t._v(" "),a("tr",[a("td",[t._v("命名空间")]),t._v(" "),a("td",[a("code",[t._v("ZM\\Annotation\\Swoole\\OnMessageEvent")])])]),t._v(" "),a("tr",[a("td",[t._v("适用位置")]),t._v(" "),a("td",[t._v("方法")])]),t._v(" "),a("tr",[a("td",[t._v("返回值处理")]),t._v(" "),a("td",[t._v("无")])])])]),t._v(" "),a("h3",{attrs:{id:"参数-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参数-4"}},[t._v("#")]),t._v(" 参数")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数名称")]),t._v(" "),a("th",[t._v("参数范围")]),t._v(" "),a("th",[t._v("用途")]),t._v(" "),a("th",[t._v("默认")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("connect_type")]),t._v(" "),a("td",[a("code",[t._v("string")])]),t._v(" "),a("td",[t._v("限定连接的类型，通过炸毛框架支持的方式指定传入类型，详见 "),a("a",{attrs:{href:"/advanced/connect-ws-client"}},[t._v("进阶 - 接入 WebSocket 客户端")])]),t._v(" "),a("td")])])]),t._v(" "),a("h3",{attrs:{id:"用法-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用法-3"}},[t._v("#")]),t._v(" 用法")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@OnMessageEvent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"foo"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@OnMessageEvent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("connect_type"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("h3",{attrs:{id:"事件绑定参数-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件绑定参数-3"}},[t._v("#")]),t._v(" 事件绑定参数")]),t._v(" "),a("p",[a("code",[t._v("$conn")]),t._v(": "),a("RouterLink",{attrs:{to:"/advanced/connect-ws-client/"}},[t._v("ConnectionObject")]),t._v(" 类型，返回一个当前 WS 连接的连接对象。")],1),t._v(" "),a("h2",{attrs:{id:"onpipemessageevent"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#onpipemessageevent"}},[t._v("#")]),t._v(" OnPipeMessageEvent()")]),t._v(" "),a("p",[t._v("当有 其他 Worker 进程通信发来指令，激活响应。（2.2.0 版本可用）")]),t._v(" "),a("h3",{attrs:{id:"属性-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#属性-5"}},[t._v("#")]),t._v(" 属性")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("值")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("名称")]),t._v(" "),a("td",[a("code",[t._v("@OnPipeMessageEvent")])])]),t._v(" "),a("tr",[a("td",[t._v("触发前提")]),t._v(" "),a("td",[t._v("当有 WebSocket 连接接入框架后发送过来消息，触发注解事件")])]),t._v(" "),a("tr",[a("td",[t._v("命名空间")]),t._v(" "),a("td",[a("code",[t._v("ZM\\Annotation\\Swoole\\OnPipeMessageEvent")])])]),t._v(" "),a("tr",[a("td",[t._v("适用位置")]),t._v(" "),a("td",[t._v("方法")])]),t._v(" "),a("tr",[a("td",[t._v("返回值处理")]),t._v(" "),a("td",[t._v("无")])])])]),t._v(" "),a("h3",{attrs:{id:"参数-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参数-5"}},[t._v("#")]),t._v(" 参数")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数名称")]),t._v(" "),a("th",[t._v("参数范围")]),t._v(" "),a("th",[t._v("用途")]),t._v(" "),a("th",[t._v("默认")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("action")]),t._v(" "),a("td",[a("code",[t._v("string")])]),t._v(" "),a("td",[t._v("限定动作名称")]),t._v(" "),a("td")])])]),t._v(" "),a("h3",{attrs:{id:"用法-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#用法-4"}},[t._v("#")]),t._v(" 用法")]),t._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@OnPipeMessageEvent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"foo"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@OnPipeMessageEvent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("action"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"bar"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("h3",{attrs:{id:"事件绑定参数-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件绑定参数-4"}},[t._v("#")]),t._v(" 事件绑定参数")]),t._v(" "),a("p",[a("code",[t._v("$data")]),t._v(": 数组，内容如下：")]),t._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"action"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"你的上面的名称"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//其他自己发送时随便定义，带什么都行")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("h2",{attrs:{id:"onswooleevent"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#onswooleevent"}},[t._v("#")]),t._v(" OnSwooleEvent()")]),t._v(" "),a("p",[t._v("绑定 Swoole 所相关的事件，例如 WebSocket 接入、收到 WS 消息、关闭 WS 连接，HTTP 请求到达等。这个是旧的统一的 Swoole 事件分发注解。"),a("strong",[t._v("请尽量使用上面几个新的注解")]),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"属性-6"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#属性-6"}},[t._v("#")]),t._v(" 属性")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("值")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("名称")]),t._v(" "),a("td",[a("code",[t._v("@OnSwooleEvent")])])]),t._v(" "),a("tr",[a("td",[t._v("触发前提")]),t._v(" "),a("td",[t._v("当参数指定的 "),a("code",[t._v("type")]),t._v(" 对应的事件被触发后激活")])]),t._v(" "),a("tr",[a("td",[t._v("命名空间")]),t._v(" "),a("td",[a("code",[t._v("ZM\\Annotation\\Swoole\\OnSwooleEvent")])])]),t._v(" "),a("tr",[a("td",[t._v("适用位置")]),t._v(" "),a("td",[t._v("方法")])]),t._v(" "),a("tr",[a("td",[t._v("返回值处理")]),t._v(" "),a("td",[t._v("无")])])])]),t._v(" "),a("h3",{attrs:{id:"注解参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注解参数"}},[t._v("#")]),t._v(" 注解参数")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数名称")]),t._v(" "),a("th",[t._v("参数范围")]),t._v(" "),a("th",[t._v("用途")]),t._v(" "),a("th",[t._v("默认")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("type")]),t._v(" "),a("td",[a("code",[t._v("string")]),t._v("，支持填入 "),a("code",[t._v("open")]),t._v("，"),a("code",[t._v("request")]),t._v("，"),a("code",[t._v("close")]),t._v("，"),a("code",[t._v("message")])]),t._v(" "),a("td",[t._v("限定事件的类型，"),a("strong",[t._v("必填")])]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("rule")]),t._v(" "),a("td",[a("code",[t._v("string")]),t._v("，必须是可执行且返回 bool 的 PHP 代码")]),t._v(" "),a("td",[t._v("例如判断连接是否为 QQ 机器人（"),a("code",[t._v("connectIsQQ()")]),t._v("）")]),t._v(" "),a("td",[t._v("空，rule 为 true")])]),t._v(" "),a("tr",[a("td",[t._v("level")]),t._v(" "),a("td",[a("code",[t._v("int")])]),t._v(" "),a("td",[t._v("事件优先级（越大越靠前）")]),t._v(" "),a("td",[t._v("20")])])])]),t._v(" "),a("h3",{attrs:{id:"事件绑定参数-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件绑定参数-5"}},[t._v("#")]),t._v(" 事件绑定参数")]),t._v(" "),a("p",[a("code",[t._v("$conn")]),t._v(": "),a("RouterLink",{attrs:{to:"/advanced/connect-ws-client/"}},[t._v("ConnectionObject")]),t._v(" 类型，返回一个当前 WS 连接的连接对象。")],1),t._v(" "),a("h2",{attrs:{id:"onstart"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#onstart"}},[t._v("#")]),t._v(" OnStart()")]),t._v(" "),a("p",[t._v("在框架加载后执行的注解事件，用于初始化 Worker 进程，此注解事件会在 Worker 进程中执行，且可以指定在哪个 Worker 进程中执行。")]),t._v(" "),a("h3",{attrs:{id:"属性-7"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#属性-7"}},[t._v("#")]),t._v(" 属性")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("值")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("名称")]),t._v(" "),a("td",[a("code",[t._v("@OnStart")])])]),t._v(" "),a("tr",[a("td",[t._v("触发前提")]),t._v(" "),a("td",[t._v("在框架加载后激活")])]),t._v(" "),a("tr",[a("td",[t._v("命名空间")]),t._v(" "),a("td",[a("code",[t._v("ZM\\Annotation\\Swoole\\OnStart")])])]),t._v(" "),a("tr",[a("td",[t._v("适用位置")]),t._v(" "),a("td",[t._v("方法")])]),t._v(" "),a("tr",[a("td",[t._v("返回值处理")]),t._v(" "),a("td",[t._v("无")])])])]),t._v(" "),a("h3",{attrs:{id:"注解参数-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注解参数-2"}},[t._v("#")]),t._v(" 注解参数")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数名称")]),t._v(" "),a("th",[t._v("参数范围")]),t._v(" "),a("th",[t._v("用途")]),t._v(" "),a("th",[t._v("默认")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("worker_id")]),t._v(" "),a("td",[a("code",[t._v("int")]),t._v("，要在哪个 Worker 进程上执行，默认为 0，范围是 0～{你设定的 Worker 数量-1}，如果是 -1 的话，则会在所有 Worker 进程上触发。")]),t._v(" "),a("td",[t._v("限定只执行的 Worker 进程")]),t._v(" "),a("td")])])]),t._v(" "),a("h2",{attrs:{id:"ontick"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ontick"}},[t._v("#")]),t._v(" OnTick()")]),t._v(" "),a("p",[t._v("在框架加载后创建毫秒计时器。")]),t._v(" "),a("h3",{attrs:{id:"属性-8"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#属性-8"}},[t._v("#")]),t._v(" 属性")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("值")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("名称")]),t._v(" "),a("td",[a("code",[t._v("@OnTick")])])]),t._v(" "),a("tr",[a("td",[t._v("触发前提")]),t._v(" "),a("td",[t._v("在框架加载后激活")])]),t._v(" "),a("tr",[a("td",[t._v("命名空间")]),t._v(" "),a("td",[a("code",[t._v("ZM\\Annotation\\Swoole\\OnTick")])])]),t._v(" "),a("tr",[a("td",[t._v("适用位置")]),t._v(" "),a("td",[t._v("方法")])]),t._v(" "),a("tr",[a("td",[t._v("返回值处理")]),t._v(" "),a("td",[t._v("无")])])])]),t._v(" "),a("h3",{attrs:{id:"注解参数-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注解参数-3"}},[t._v("#")]),t._v(" 注解参数")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数名称")]),t._v(" "),a("th",[t._v("参数范围")]),t._v(" "),a("th",[t._v("用途")]),t._v(" "),a("th",[t._v("默认")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("tick_ms")]),t._v(" "),a("td",[a("code",[t._v("int")]),t._v("，"),a("strong",[t._v("必填")]),t._v("，间隔的毫秒数，例如 1 秒间隔为 "),a("code",[t._v("1000")]),t._v("，范围大于 0，小于 86400000。")]),t._v(" "),a("td"),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("worker_id")]),t._v(" "),a("td",[a("code",[t._v("int")]),t._v("，要在哪个 Worker 进程上执行，默认为 0，范围是 0～{你设定的 Worker 数量-1}，如果是 -1 的话，则会在所有 Worker 进程上触发。")]),t._v(" "),a("td",[t._v("限定只执行的 Worker 进程")]),t._v(" "),a("td")])])]),t._v(" "),a("h2",{attrs:{id:"ontask"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ontask"}},[t._v("#")]),t._v(" OnTask()")]),t._v(" "),a("p",[t._v("定义一个在工作进程中运行的任务函数。详情见 "),a("a",{attrs:{href:"/advanced/task-worker"}},[t._v("进阶 - 使用 TaskWorker 进程处理密集运算")]),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"属性-9"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#属性-9"}},[t._v("#")]),t._v(" 属性")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("值")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("名称")]),t._v(" "),a("td",[a("code",[t._v("@OnTask")])])]),t._v(" "),a("tr",[a("td",[t._v("触发前提")]),t._v(" "),a("td",[t._v("在框架加载后激活")])]),t._v(" "),a("tr",[a("td",[t._v("命名空间")]),t._v(" "),a("td",[a("code",[t._v("ZM\\Annotation\\Swoole\\OnTask")])])]),t._v(" "),a("tr",[a("td",[t._v("适用位置")]),t._v(" "),a("td",[t._v("方法")])]),t._v(" "),a("tr",[a("td",[t._v("返回值处理")]),t._v(" "),a("td",[t._v("有，返回 Worker 进程的结果")])])])]),t._v(" "),a("h3",{attrs:{id:"注解参数-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注解参数-4"}},[t._v("#")]),t._v(" 注解参数")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数名称")]),t._v(" "),a("th",[t._v("参数范围")]),t._v(" "),a("th",[t._v("用途")]),t._v(" "),a("th",[t._v("默认")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("task_name")]),t._v(" "),a("td",[a("code",[t._v("string")]),t._v("，"),a("strong",[t._v("必填")]),t._v("，任务函数的名称，不建议重复。")]),t._v(" "),a("td"),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("rule")]),t._v(" "),a("td",[t._v("设置触发前提，PHP 代码，返回 bool 值即可，参考 OnRequestEvent")]),t._v(" "),a("td",[t._v("限定是否执行")]),t._v(" "),a("td",[t._v("空")])])])]),t._v(" "),a("h2",{attrs:{id:"onsetup"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#onsetup"}},[t._v("#")]),t._v(" OnSetup()")]),t._v(" "),a("p",[t._v("在框架加载前执行的代码。此部分代码是在主进程执行的，不可在此事件中使用任何协程相关的功能。")]),t._v(" "),a("p",[t._v("比如我们要改变所有进程的 ini 设置，这时使用 "),a("code",[t._v("@OnStart(-1)")]),t._v(" 这样只设置了 Worker 进程的内容，而主进程和管理进程无法被覆盖到。如果需要设置全局的一些配置，务必在此 "),a("code",[t._v("@OnSetup")]),t._v(" 注解下执行。")]),t._v(" "),a("h3",{attrs:{id:"属性-10"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#属性-10"}},[t._v("#")]),t._v(" 属性")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("值")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("名称")]),t._v(" "),a("td",[a("code",[t._v("@OnSetup")])])]),t._v(" "),a("tr",[a("td",[t._v("触发前提")]),t._v(" "),a("td",[t._v("在框架加载前激活")])]),t._v(" "),a("tr",[a("td",[t._v("命名空间")]),t._v(" "),a("td",[a("code",[t._v("ZM\\Annotation\\Swoole\\OnSetup")])])]),t._v(" "),a("tr",[a("td",[t._v("适用位置")]),t._v(" "),a("td",[t._v("方法")])]),t._v(" "),a("tr",[a("td",[t._v("返回值处理")]),t._v(" "),a("td",[t._v("无")])])])]),t._v(" "),a("h3",{attrs:{id:"注解参数-5"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注解参数-5"}},[t._v("#")]),t._v(" 注解参数")]),t._v(" "),a("p",[t._v("无。")]),t._v(" "),a("h2",{attrs:{id:"terminalcommand"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#terminalcommand"}},[t._v("#")]),t._v(" TerminalCommand()")]),t._v(" "),a("p",[t._v("添加一个远程终端的自定义命令。（2.4.0 版本起可用）")]),t._v(" "),a("h3",{attrs:{id:"属性-11"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#属性-11"}},[t._v("#")]),t._v(" 属性")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("类型")]),t._v(" "),a("th",[t._v("值")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("名称")]),t._v(" "),a("td",[a("code",[t._v("@TerminalCommand")])])]),t._v(" "),a("tr",[a("td",[t._v("触发前提")]),t._v(" "),a("td",[t._v("连接到远程终端可触发")])]),t._v(" "),a("tr",[a("td",[t._v("命名空间")]),t._v(" "),a("td",[a("code",[t._v("ZM\\Annotation\\Command\\TerminalCommand")])])]),t._v(" "),a("tr",[a("td",[t._v("适用位置")]),t._v(" "),a("td",[t._v("方法")])]),t._v(" "),a("tr",[a("td",[t._v("返回值处理")]),t._v(" "),a("td",[t._v("无")])])])]),t._v(" "),a("h3",{attrs:{id:"注解参数-6"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注解参数-6"}},[t._v("#")]),t._v(" 注解参数")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("参数名称")]),t._v(" "),a("th",[t._v("参数范围")]),t._v(" "),a("th",[t._v("默认")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("command")]),t._v(" "),a("td",[a("code",[t._v("string")]),t._v("，"),a("strong",[t._v("必填")]),t._v("，命令字符串")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("alias")]),t._v(" "),a("td",[a("code",[t._v("string")]),t._v("，可选，命令的别名")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[t._v("description")]),t._v(" "),a("td",[a("code",[t._v("string")]),t._v("，要显示的帮助文本")]),t._v(" "),a("td",[t._v("空")])])])]),t._v(" "),a("h2",{attrs:{id:"示例1-机器人连接框架后输出信息"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例1-机器人连接框架后输出信息"}},[t._v("#")]),t._v(" 示例1（机器人连接框架后输出信息）")]),t._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token php language-php"}},[a("span",{pre:!0,attrs:{class:"token delimiter important"}},[t._v("<?php")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("namespace")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token package"}},[t._v("Module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Example")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token package"}},[t._v("ZM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Annotation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Swoole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("OnOpenEvent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token package"}},[t._v("ZM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("ConnectionManager"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("ConnectionObject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token package"}},[t._v("ZM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Console")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name-definition class-name"}},[t._v("Hello")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/**\n \t * 在机器人客户端连接框架后向终端输出信息\n \t * @OnOpenEvent("qq")\n\t * @param $conn\n \t */')]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-definition function"}},[t._v("onConnect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name type-declaration"}},[t._v("ConnectionObject")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$conn")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t    "),a("span",{pre:!0,attrs:{class:"token class-name static-context"}},[t._v("Console")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("info")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"机器人 "')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$conn")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getOption")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"connect_id"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('" 已连接！"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br")])]),a("p",[t._v("这里的 Console 是终端输出组件，详情见组件一栏对应的文档查询。")]),t._v(" "),a("h2",{attrs:{id:"示例2-阻断-chrome-访问框架时多访问一次的问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例2-阻断-chrome-访问框架时多访问一次的问题"}},[t._v("#")]),t._v(" 示例2（阻断 Chrome 访问框架时多访问一次的问题）")]),t._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token php language-php"}},[a("span",{pre:!0,attrs:{class:"token delimiter important"}},[t._v("<?php")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("namespace")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token package"}},[t._v("Module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Example")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token package"}},[t._v("ZM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Annotation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Swoole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("OnSwooleEvent")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token package"}},[t._v("ZM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Event"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("EventDispatcher")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name-definition class-name"}},[t._v("Hello")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * 阻止 Chrome 自动请求 /favicon.ico 导致的多条请求并发和干扰\n     * @OnRequestEvent(rule=\"ctx()->getRequest()->server['request_uri'] == '/favicon.ico'\",level=200)\n     */")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-definition function"}},[t._v("onRequest")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name static-context"}},[t._v("EventDispatcher")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("interrupt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br")])]),a("p",[t._v("其中 EventDispatcher 为事件分发器，interrupt 是通用阻断方法，如果你平常只使用阻断，则只需掌握这一个方法即可，"),a("code",[t._v("EventDispatcher::interrupt()")]),t._v(" 在所有事件内可用。")]),t._v(" "),a("h2",{attrs:{id:"示例3-接收-ws-客户端发来的数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例3-接收-ws-客户端发来的数据"}},[t._v("#")]),t._v(" 示例3（接收 WS 客户端发来的数据）")]),t._v(" "),a("p",[t._v("见 "),a("a",{attrs:{href:"/advanced/connect-ws-client"}},[t._v("接入 WebSocket 客户端")]),t._v("。")]),t._v(" "),a("h2",{attrs:{id:"示例4-使用-onstart-给所有-worker-进程写入缓存提速"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例4-使用-onstart-给所有-worker-进程写入缓存提速"}},[t._v("#")]),t._v(" 示例4（使用 OnStart 给所有 Worker 进程写入缓存提速）")]),t._v(" "),a("p",[t._v("如果你有一些数据存到了文件、数据库中，且是只读不写的，那么就可以使用此方法将这个文件或者数据库的内容读入 Worker 进程的内存中进行使用来提速。")]),t._v(" "),a("p",[t._v("假设我们有一个大文件 json，里面存着一份题库，例如：")]),t._v(" "),a("div",{staticClass:"language-json line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"0"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"question"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"法的调整对象是（ ）。"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"answer"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"A"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"行为关系"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"B"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"思想关系"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"C"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"利益关系"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"D"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"各种社会资源"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"key"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"A"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"answer_type"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"1"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"question"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"法律与其他社会规范的区别在于（ ）。"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"answer"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"A"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"是调整人们行为的规范"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"B"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"有约束力"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"C"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"由国家强制力保证执行"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"D"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"规定制裁措施"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"key"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"C"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"answer_type"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br")])]),a("p",[t._v("那么我们可以使用 OnStart 来实现一个，将此文件读取到每个 Worker 进程中，并且快速取用的功能（以下做了一个简单的查题功能）：")]),t._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token php language-php"}},[a("span",{pre:!0,attrs:{class:"token delimiter important"}},[t._v("<?php")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("namespace")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token package"}},[t._v("Module"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Example")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token package"}},[t._v("ZM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Annotation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Swoole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("OnStart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token package"}},[t._v("ZM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Annotation"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("CQ"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("CQCommand")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token package"}},[t._v("ZM"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("Console")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name-definition class-name"}},[t._v("Hello")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$tiku")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * @OnStart(-1)\n     */")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-definition function"}},[t._v("onStart")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 注意，此函数将会在每个 Worker 执行一次")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$file")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("file_get_contents")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"tiku.json"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//从文件读取json")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$json")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("json_decode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$file")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant boolean"}},[t._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//json解析")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name static-context"}},[t._v("Hello")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$tiku")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$json")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//将解析后的数组以静态变量的方式存到每个 Worker 的内存中")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name static-context"}},[t._v("Console")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("success")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"加载题库完成！"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('/**\n     * @CQCommand("找题")\n     */')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-definition function"}},[t._v("findQuestion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$tiku_id")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ctx")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getNumArg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"请输入题目的序号"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("isset")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name static-context"}},[t._v("Hello")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$tiku")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$tiku_id")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"题目id为"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$tiku_id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"的题目不存在！"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$timu")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name static-context"}},[t._v("Hello")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$tiku")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$tiku_id")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$msg")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"题目名称："')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$timu")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"question"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("foreach")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$timu")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"answer"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("as")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$k")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$v")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$msg")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"\\n"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$k")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('". "')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$v")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$msg")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"\\n正确答案："')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$timu")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"key"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$msg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br"),a("span",{staticClass:"line-number"},[t._v("16")]),a("br"),a("span",{staticClass:"line-number"},[t._v("17")]),a("br"),a("span",{staticClass:"line-number"},[t._v("18")]),a("br"),a("span",{staticClass:"line-number"},[t._v("19")]),a("br"),a("span",{staticClass:"line-number"},[t._v("20")]),a("br"),a("span",{staticClass:"line-number"},[t._v("21")]),a("br"),a("span",{staticClass:"line-number"},[t._v("22")]),a("br"),a("span",{staticClass:"line-number"},[t._v("23")]),a("br"),a("span",{staticClass:"line-number"},[t._v("24")]),a("br"),a("span",{staticClass:"line-number"},[t._v("25")]),a("br"),a("span",{staticClass:"line-number"},[t._v("26")]),a("br"),a("span",{staticClass:"line-number"},[t._v("27")]),a("br"),a("span",{staticClass:"line-number"},[t._v("28")]),a("br"),a("span",{staticClass:"line-number"},[t._v("29")]),a("br"),a("span",{staticClass:"line-number"},[t._v("30")]),a("br"),a("span",{staticClass:"line-number"},[t._v("31")]),a("br")])]),a("p",[t._v("终端效果：（我们假设运行框架的电脑是四核 CPU）")]),t._v(" "),a("div",{staticClass:"language-log line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-log"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token time number"}},[t._v("14:28:00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("S"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" 加载题库完成！\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token time number"}},[t._v("14:28:00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("S"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" 加载题库完成！\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token time number"}},[t._v("14:28:00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("S"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" 加载题库完成！\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token time number"}},[t._v("14:28:00")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("S"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("#")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" 加载题库完成！\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("p",[t._v("聊天效果：")]),t._v(" "),a("chat-box",{attrs:{"my-chats":[{type:0,content:"找题 1"},{type:1,content:"题目名称：法律与其他社会规范的区别在于（ ）。\nA. 是调整人们行为的规范\nB. 有约束力\nC. 由国家强制力保证执行\nD. 规定制裁措施\n正确答案：C"}]}}),t._v(" "),a("h2",{attrs:{id:"示例5-创建每分钟自动执行的爬虫"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例5-创建每分钟自动执行的爬虫"}},[t._v("#")]),t._v(" 示例5（创建每分钟自动执行的爬虫）")]),t._v(" "),a("div",{staticClass:"language-php line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-php"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * @OnTick(tick_ms=60000,worker_id=0)\n */")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-definition function"}},[t._v("onCrawl")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$data")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name static-context"}},[t._v("Foo")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("bar")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//这里是你自己写的要爬的接口等等一系列操作")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token class-name static-context"}},[t._v("LightCache")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("set")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string double-quoted-string"}},[t._v('"your_data_key_name"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//将爬虫数据存入 LightCache 轻量缓存")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br")])]),a("h2",{attrs:{id:"示例6-创建一个远程终端命令并调试框架"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#示例6-创建一个远程终端命令并调试框架"}},[t._v("#")]),t._v(" 示例6（创建一个远程终端命令并调试框架）")]),t._v(" "),a("blockquote",[a("p",[t._v("开个坑，以后填。（"),a("strong",[t._v("填坑标记")]),t._v("）")])])],1)}),[],!1,null,null,null);s.default=e.exports}}]);