{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{214:function(s,t,n){\"use strict\";n.r(t);var a=n(27),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":s.$parent.slotKey}},[n(\"h1\",{attrs:{id:\"websocket-服务器\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#websocket-服务器\"}},[s._v(\"#\")]),s._v(\" WebSocket 服务器\")]),s._v(\" \"),n(\"p\",[s._v(\"炸毛框架不仅仅完全支持 HTTP 的各类服务扩展，还支持 WebSocket 各类服务的扩展。\")]),s._v(\" \"),n(\"div\",{staticClass:\"custom-block warning\"},[n(\"p\",{staticClass:\"custom-block-title\"},[s._v(\"注意\")]),s._v(\" \"),n(\"p\",[s._v(\"为了减少篇幅和便于阅读，下文中的 \"),n(\"strong\",[s._v(\"WS\")]),s._v(\" 均指 WebSocket。\")])]),s._v(\" \"),n(\"h2\",{attrs:{id:\"连接对象\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#连接对象\"}},[s._v(\"#\")]),s._v(\" 连接对象\")]),s._v(\" \"),n(\"p\",[s._v(\"炸毛框架对连接到端口的 WS 连接进行了一系列管理。首先为了分类和辨别链接类型，框架会约定以下规则，请在开发其他 WS 客户端连接炸毛框架时遵守：\")]),s._v(\" \"),n(\"ol\",[n(\"li\",[s._v(\"在握手时，GET参数中的 \"),n(\"code\",[s._v(\"type\")]),s._v(\" 参数或 Header 中的 \"),n(\"code\",[s._v(\"X-Client-Rule\")]),s._v(\" 作为判断连接类型的依据，必须指定其中之一。\")]),s._v(\" \"),n(\"li\",[s._v(\"关于不同种类的连接鉴权问题，框架不提供解决方案，可通过监听 \"),n(\"code\",[s._v('@SwooleEventAt(\"open\")')]),s._v(\" 事件进行编写自己的鉴权规则。\")]),s._v(\" \"),n(\"li\",[s._v(\"如果未指定 \"),n(\"code\",[s._v(\"type\")]),s._v(\" 或类型在框架中未声明，则一律归为 \"),n(\"code\",[s._v(\"unknown\")]),s._v(\" 类型，对应类 \"),n(\"code\",[s._v(\"UnknownConnection\")]),s._v(\"。\")])]),s._v(\" \"),n(\"blockquote\",[n(\"p\",[s._v(\"在框架默认自带的示例模块类 \"),n(\"strong\",[s._v(\"Hello\")]),s._v(\" 中包含了对 \"),n(\"code\",[s._v(\"unknown\")]),s._v(\" 类型链接的自动断开函数。如果不需要或进行判定可自行扩展和修改。\")])]),s._v(\" \"),n(\"p\",[s._v(\"以下所有连接对象的命名空间均为 \"),n(\"code\",[s._v(\"ZM\\\\Connection\\\\xxxConnection\")]),s._v(\" 或自定义的 \"),n(\"code\",[s._v(\"Custom\\\\Connection\\\\xxxConnection\")])]),s._v(\" \"),n(\"h3\",{attrs:{id:\"基类-wsconnection\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#基类-wsconnection\"}},[s._v(\"#\")]),s._v(\" 基类 WSConnection\")]),s._v(\" \"),n(\"p\",[s._v(\"在框架的定义中，所有的链接对象都将实例化为基于 WSConnection 类的对象，比如上面提到的 \"),n(\"code\",[s._v(\"unknown\")]),s._v(\" 类型对应实例化为 \"),n(\"code\",[s._v(\"UnknownConnection\")]),s._v(\"。\\n基类提供以下函数供操作：\")]),s._v(\" \"),n(\"ul\",[n(\"li\",[n(\"code\",[s._v(\"exists()\")]),s._v(\"：判断此链接是否还存在\")]),s._v(\" \"),n(\"li\",[n(\"code\",[s._v(\"close()\")]),s._v(\"：关闭此链接，并自动销毁此对象。后续不可对本对象操作\")]),s._v(\" \"),n(\"li\",[n(\"code\",[s._v(\"push($data, $error_record = true)\")]),s._v(\"：给此链接的客户端推送消息，data 为内容，第二个参数为 \"),n(\"code\",[s._v(\"false\")]),s._v(\" 时不写入日志。推送成功时返回 \"),n(\"code\",[s._v(\"true\")]),s._v(\"，失败时为 \"),n(\"code\",[s._v(\"false\")])]),s._v(\" \"),n(\"li\",[n(\"code\",[s._v(\"getType()\")]),s._v(\"：获取此对象类型的字符串名称，是抽象方法。\")])]),s._v(\" \"),n(\"h3\",{attrs:{id:\"cqconnection\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#cqconnection\"}},[s._v(\"#\")]),s._v(\" CQConnection\")]),s._v(\" \"),n(\"p\",[s._v(\"框架支持 CQHTTP 插件请求过来的反向 WS 链接，在框架内定义的类型是 \"),n(\"code\",[s._v(\"qq\")]),s._v(\"，对应类为 \"),n(\"code\",[s._v(\"CQConnection\")]),s._v(\"。\")]),s._v(\" \"),n(\"p\",[s._v(\"此连接类型对象提供以下函数：\")]),s._v(\" \"),n(\"ul\",[n(\"li\",[n(\"code\",[s._v(\"getQQ()\")]),s._v(\"：获取此链接对应机器人的 QQ 号码\")])]),s._v(\" \"),n(\"h3\",{attrs:{id:\"连接对象使用示例\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#连接对象使用示例\"}},[s._v(\"#\")]),s._v(\" 连接对象使用示例\")]),s._v(\" \"),n(\"p\",[s._v(\"下面是一个调用 CQAPI 的示例，需要使用传入的连接对象：\")]),s._v(\" \"),n(\"div\",{staticClass:\"language-php line-numbers-mode\"},[n(\"pre\",{pre:!0,attrs:{class:\"language-php\"}},[n(\"code\",[n(\"span\",{pre:!0,attrs:{class:\"token php language-php\"}},[n(\"span\",{pre:!0,attrs:{class:\"token delimiter important\"}},[s._v(\"<?php\")]),s._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"namespace\")]),s._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token package\"}},[s._v(\"Module\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"\\\\\")]),s._v(\"Example\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"use\")]),s._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token package\"}},[s._v(\"ZM\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"\\\\\")]),s._v(\"ModBase\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"use\")]),s._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token package\"}},[s._v(\"ZM\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"\\\\\")]),s._v(\"Annotation\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"\\\\\")]),s._v(\"CQ\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"\\\\\")]),s._v(\"CQCommand\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"use\")]),s._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token package\"}},[s._v(\"ZM\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"\\\\\")]),s._v(\"API\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"\\\\\")]),s._v(\"CQAPI\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"class\")]),s._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"Hello\")]),s._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"extends\")]),s._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"ModBase\")]),s._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v('/**\\n     * @CQCommand(\"状态\")\\n     */')]),s._v(\"\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"public\")]),s._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"function\")]),s._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"status\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n        \"),n(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"$r\")]),s._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"=\")]),s._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token constant\"}},[s._v(\"CQAPI\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\":\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"get_status\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"$this\")]),n(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"-\")]),n(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\">\")]),n(\"span\",{pre:!0,attrs:{class:\"token property\"}},[s._v(\"connection\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"[\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"]\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),s._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token boolean constant\"}},[s._v(\"true\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n        \"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"return\")]),s._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token double-quoted-string string\"}},[s._v('\"API请求结果：\"')]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\".\")]),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"json_encode\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token variable\"}},[s._v(\"$r\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\",\")]),n(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"128\")]),n(\"span\",{pre:!0,attrs:{class:\"token operator\"}},[s._v(\"|\")]),n(\"span\",{pre:!0,attrs:{class:\"token number\"}},[s._v(\"256\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\")])])]),s._v(\" \"),n(\"div\",{staticClass:\"line-numbers-wrapper\"},[n(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),n(\"br\")])]),n(\"h2\",{attrs:{id:\"自定义连接\"}},[n(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#自定义连接\"}},[s._v(\"#\")]),s._v(\" 自定义连接\")]),s._v(\" \"),n(\"p\",[s._v(\"当然默认框架只支持了 \"),n(\"code\",[s._v(\"qq\")]),s._v(\" 一种连接类型，为了扩展性，你可以在 \"),n(\"code\",[s._v(\"src/Custom/Connection/\")]),s._v(\" 下编写自己的链接类型。\")]),s._v(\" \"),n(\"div\",{staticClass:\"language-php line-numbers-mode\"},[n(\"pre\",{pre:!0,attrs:{class:\"language-php\"}},[n(\"code\",[n(\"span\",{pre:!0,attrs:{class:\"token php language-php\"}},[n(\"span\",{pre:!0,attrs:{class:\"token delimiter important\"}},[s._v(\"<?php\")]),s._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"namespace\")]),s._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token package\"}},[s._v(\"Custom\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"\\\\\")]),s._v(\"Connection\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"use\")]),s._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token package\"}},[s._v(\"ZM\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"\\\\\")]),s._v(\"Connection\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"\\\\\")]),s._v(\"WSConnection\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"class\")]),s._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"CustomConnection\")]),s._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"extends\")]),s._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token class-name\"}},[s._v(\"WSConnection\")]),s._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"public\")]),s._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"function\")]),s._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token function\"}},[s._v(\"getType\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"(\")]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\")\")]),s._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"{\")]),s._v(\"\\n        \"),n(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"return\")]),s._v(\" \"),n(\"span\",{pre:!0,attrs:{class:\"token double-quoted-string string\"}},[s._v('\"custom\"')]),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\";\")]),s._v(\"\\n    \"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\"),n(\"span\",{pre:!0,attrs:{class:\"token punctuation\"}},[s._v(\"}\")]),s._v(\"\\n\")])])]),s._v(\" \"),n(\"div\",{staticClass:\"line-numbers-wrapper\"},[n(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),n(\"br\"),n(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),n(\"br\")])])])}),[],!1,null,null,null);t.default=e.exports}}]);","extractedComments":[]}