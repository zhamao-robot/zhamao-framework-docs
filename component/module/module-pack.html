<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>模块打包 | 炸毛框架</title>
    <meta name="description" content="">
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/logo_trans.png">
    <meta name="description" content="一个聊天机器人 + Web 框架">
    <link rel="preload" href="/assets/css/0.styles.4f1f2ddd.css" as="style"><link rel="preload" href="/assets/js/app.74588e53.js" as="script"><link rel="preload" href="/assets/js/2.75938045.js" as="script"><link rel="preload" href="/assets/js/37.34442c2f.js" as="script"><link rel="prefetch" href="/assets/js/10.79266778.js"><link rel="prefetch" href="/assets/js/11.8e8b9c1c.js"><link rel="prefetch" href="/assets/js/12.1aa8af8d.js"><link rel="prefetch" href="/assets/js/13.e98b2c1e.js"><link rel="prefetch" href="/assets/js/14.395e9555.js"><link rel="prefetch" href="/assets/js/15.bcf42e0c.js"><link rel="prefetch" href="/assets/js/16.8f6fc64c.js"><link rel="prefetch" href="/assets/js/17.0f018799.js"><link rel="prefetch" href="/assets/js/18.62cc7348.js"><link rel="prefetch" href="/assets/js/19.ed179fd8.js"><link rel="prefetch" href="/assets/js/20.af6d7f5f.js"><link rel="prefetch" href="/assets/js/21.959e09bc.js"><link rel="prefetch" href="/assets/js/22.fff2e11d.js"><link rel="prefetch" href="/assets/js/23.81d248f1.js"><link rel="prefetch" href="/assets/js/24.7ea844d4.js"><link rel="prefetch" href="/assets/js/25.4775db64.js"><link rel="prefetch" href="/assets/js/26.9de15027.js"><link rel="prefetch" href="/assets/js/27.9faaf54f.js"><link rel="prefetch" href="/assets/js/28.0fc6fc6f.js"><link rel="prefetch" href="/assets/js/29.528545ee.js"><link rel="prefetch" href="/assets/js/3.20d8151f.js"><link rel="prefetch" href="/assets/js/30.fbc5baa2.js"><link rel="prefetch" href="/assets/js/31.cd7f1b2a.js"><link rel="prefetch" href="/assets/js/32.cbf54b51.js"><link rel="prefetch" href="/assets/js/33.fbe3aefc.js"><link rel="prefetch" href="/assets/js/34.8e93a274.js"><link rel="prefetch" href="/assets/js/35.a9c6f0e1.js"><link rel="prefetch" href="/assets/js/36.801d10b2.js"><link rel="prefetch" href="/assets/js/38.0d22afe7.js"><link rel="prefetch" href="/assets/js/39.df2b343d.js"><link rel="prefetch" href="/assets/js/4.f559d98c.js"><link rel="prefetch" href="/assets/js/40.ff34ea85.js"><link rel="prefetch" href="/assets/js/41.904d1bdb.js"><link rel="prefetch" href="/assets/js/42.55136576.js"><link rel="prefetch" href="/assets/js/43.eecb0523.js"><link rel="prefetch" href="/assets/js/44.21d92854.js"><link rel="prefetch" href="/assets/js/45.60bd4047.js"><link rel="prefetch" href="/assets/js/46.67574b24.js"><link rel="prefetch" href="/assets/js/47.630d0104.js"><link rel="prefetch" href="/assets/js/48.61bdd0dd.js"><link rel="prefetch" href="/assets/js/49.ad1d841c.js"><link rel="prefetch" href="/assets/js/5.5c38bd1d.js"><link rel="prefetch" href="/assets/js/50.8b2a73b5.js"><link rel="prefetch" href="/assets/js/51.9b3d55d4.js"><link rel="prefetch" href="/assets/js/52.1bd21bf7.js"><link rel="prefetch" href="/assets/js/53.c1ce5f71.js"><link rel="prefetch" href="/assets/js/54.920966b3.js"><link rel="prefetch" href="/assets/js/55.75980cfc.js"><link rel="prefetch" href="/assets/js/56.de0caf13.js"><link rel="prefetch" href="/assets/js/57.d40f4a21.js"><link rel="prefetch" href="/assets/js/58.d2313779.js"><link rel="prefetch" href="/assets/js/59.6f3f55a4.js"><link rel="prefetch" href="/assets/js/6.984ee6dd.js"><link rel="prefetch" href="/assets/js/60.1b334d32.js"><link rel="prefetch" href="/assets/js/61.e1cddf2f.js"><link rel="prefetch" href="/assets/js/62.888693bf.js"><link rel="prefetch" href="/assets/js/63.3ff69aff.js"><link rel="prefetch" href="/assets/js/64.8b2a9876.js"><link rel="prefetch" href="/assets/js/65.cd05ae88.js"><link rel="prefetch" href="/assets/js/66.bd801a87.js"><link rel="prefetch" href="/assets/js/67.77d4f2b6.js"><link rel="prefetch" href="/assets/js/68.1ac70113.js"><link rel="prefetch" href="/assets/js/69.6db3887b.js"><link rel="prefetch" href="/assets/js/7.6bc6073f.js"><link rel="prefetch" href="/assets/js/70.a2295aa6.js"><link rel="prefetch" href="/assets/js/71.2d57818a.js"><link rel="prefetch" href="/assets/js/72.ad91bbab.js"><link rel="prefetch" href="/assets/js/73.593e3ccc.js"><link rel="prefetch" href="/assets/js/74.df93f1ea.js"><link rel="prefetch" href="/assets/js/8.4b643103.js"><link rel="prefetch" href="/assets/js/9.53daa5d4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4f1f2ddd.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="ant-row"><div class="nav-button"><i aria-label="icon: bars" class="anticon anticon-bars"><svg viewBox="0 0 1024 1024" focusable="false" data-icon="bars" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M912 192H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 284H328c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h584c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM104 228a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0zm0 284a56 56 0 1 0 112 0 56 56 0 1 0-112 0z"></path></svg></i> <span></span></div> <div class="ant-col ant-col-xs-24 ant-col-sm-24 ant-col-md-6 ant-col-lg-5 ant-col-xl-5 ant-col-xxl-4"><a href="/" class="router-link-active home-link"><img src="/logo_trans.png" alt="炸毛框架" class="logo"> <span class="site-name">炸毛框架</span></a> <div class="search-box mobile-search"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div></div> <div class="ant-col ant-col-xs-0 ant-col-sm-0 ant-col-md-18 ant-col-lg-19 ant-col-xl-19 ant-col-xxl-20"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><ul role="menu" id="nav" class="ant-menu ant-menu-horizontal ant-menu-root ant-menu-light"><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/guide/">
          指南
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/event/">
          事件和注解
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/component/" class="router-link-active">
          组件
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/advanced/">
          进阶
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/faq/">
          FAQ
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="/update/v2/">
          更新日志
        </a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="display:none;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li><li role="menuitem" class="ant-menu-item"><a href="https://docs-v1.zhamao.xin/" target="_blank">
          炸毛框架 v1
          <i aria-label="icon: link" class="anticon anticon-link"><svg viewBox="64 64 896 896" focusable="false" data-icon="link" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M574 665.4a8.03 8.03 0 0 0-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 0 0-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 0 0 0 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 0 0 0 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 0 0-11.3 0L372.3 598.7a8.03 8.03 0 0 0 0 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"></path></svg></i></a></li><li role="menuitem" class="ant-menu-submenu ant-menu-submenu-horizontal ant-menu-overflowed-submenu" style="visibility:hidden;position:absolute;"><div aria-haspopup="true" class="ant-menu-submenu-title"><span>···</span><i class="ant-menu-submenu-arrow"></i></div></li></ul> <a href="https://github.com/zhamao-robot/zhamao-framework" target="_blank" rel="noopener noreferrer" class="repo-link"><i aria-label="icon: github" class="anticon anticon-github"><svg viewBox="64 64 896 896" focusable="false" data-icon="github" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M511.6 76.3C264.3 76.2 64 276.4 64 523.5 64 718.9 189.3 885 363.8 946c23.5 5.9 19.9-10.8 19.9-22.2v-77.5c-135.7 15.9-141.2-73.9-150.3-88.9C215 726 171.5 718 184.5 703c30.9-15.9 62.4 4 98.9 57.9 26.4 39.1 77.9 32.5 104 26 5.7-23.5 17.9-44.5 34.7-60.8-140.6-25.2-199.2-111-199.2-213 0-49.5 16.3-95 48.3-131.7-20.4-60.5 1.9-112.3 4.9-120 58.1-5.2 118.5 41.6 123.2 45.3 33-8.9 70.7-13.6 112.9-13.6 42.4 0 80.2 4.9 113.5 13.9 11.3-8.6 67.3-48.8 121.3-43.9 2.9 7.7 24.7 58.3 5.5 118 32.4 36.8 48.9 82.7 48.9 132.3 0 102.2-59 188.1-200 212.9a127.5 127.5 0 0 1 38.1 91v112.5c.8 9 0 17.9 15 17.9 177.1-59.7 304.6-227 304.6-424.1 0-247.2-200.4-447.3-447.5-447.3z"></path></svg></i></a></nav></div></div> <!----></header> <aside class="sidebar"><!----> <ul class="sidebar-links"><li><a href="/component/" aria-current="page" title="框架组件" class="sidebar-link">框架组件</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>聊天机器人组件</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>存储组件</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>通用组件</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTTP 组件</span> <span class="arrow right"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>模块/插件管理</span> <span class="arrow down"><i aria-label="icon: down" class="anticon anticon-down"><svg viewBox="64 64 896 896" focusable="false" data-icon="down" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"></path></svg></i></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/component/module/module-pack.html" aria-current="page" title="模块打包" class="active sidebar-link">模块打包</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/component/module/module-pack.html#构建模块包配置文件" title="构建模块包配置文件" class="sidebar-link">构建模块包配置文件</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/component/module/module-pack.html#配置文件参数" title="配置文件参数" class="sidebar-link">配置文件参数</a></li></ul></li><li class="sidebar-sub-header"><a href="/component/module/module-pack.html#打包模块命令" title="打包模块命令" class="sidebar-link">打包模块命令</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/component/module/module-pack.html#module-list" title="module:list" class="sidebar-link">module:list</a></li><li class="sidebar-sub-header"><a href="/component/module/module-pack.html#module-pack" title="module:pack" class="sidebar-link">module:pack</a></li></ul></li><li class="sidebar-sub-header"><a href="/component/module/module-pack.html#打包命令" title="打包命令" class="sidebar-link">打包命令</a></li><li class="sidebar-sub-header"><a href="/component/module/module-pack.html#查看模块信息命令" title="查看模块信息命令" class="sidebar-link">查看模块信息命令</a></li></ul></li><li><a href="/component/module/module-unpack.html" title="模块解包" class="sidebar-link">模块解包</a></li></ul></section></li></ul></aside> <main class="page"> <div class="theme-antdocs-content content__default"><h1 id="模块打包"><a href="#模块打包" class="header-anchor">#</a> 模块打包</h1> <p>从 2.5 版本起，炸毛框架的模块源码支持了打包和分发，开发者可以通过将自己的功能编写打包，并通过互联网进行分发，供其他人使用。此外，还提供了模块包热加载（不解包直接运行）和模块包解包功能。</p> <h2 id="构建模块包配置文件"><a href="#构建模块包配置文件" class="header-anchor">#</a> 构建模块包配置文件</h2> <p>炸毛框架的模块区分是根据 <code>src</code> 目录下的文件夹定义的，模块包的配置文件命名必须为 <code>zm.json</code>，此外，假设我们编写了一个最简单的模块，以脚手架生成的 Example 模块为例，文件夹结构如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>src/
└── Module/
    ├── Example/
    │   ├── Hello.php
    │   └── zm.json
    └── Middleware/
        └── TimerMiddleware.php
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>我们在 Example 目录下创建一个 <code>zm.json</code> 的文件，编写配置，即代表 <code>src/Module/Example/</code> 文件夹及里面的用户模块源码为一个模块包，也就可以被框架识别并打包处理。</p> <p>编写的配置文件结构如下：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
	&quot;name&quot;: &quot;my-first-module&quot;
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>对！你没看错，只需要定义一个 <code>name</code> 字段，即可声明这是一个模块包！</p> <h3 id="配置文件参数"><a href="#配置文件参数" class="header-anchor">#</a> 配置文件参数</h3> <h4 id="description"><a href="#description" class="header-anchor">#</a> - description</h4> <ul><li><p>类型：<code>string</code>。</p></li> <li><p>含义：模块的描述。</p></li></ul> <div class="custom-block tip"><p class="custom-block-title">编写实例</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;my-first-module&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;这个是一个示例模块打包教程&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div> <h4 id="version"><a href="#version" class="header-anchor">#</a> - version</h4> <ul><li>类型：string。</li> <li>含义：模块的版本。</li></ul> <p>版本处理方式和 Composer 基本一致，建议使用三段式，也就是 <code>大版本.小版本.补丁版本</code>。关于三段式版本的描述和规范，见 <a href="https://www.chrisyue.com/what-the-hell-are-semver-and-the-difference-between-composer-version-control-sign-tilde-and-caret.html" target="_blank" rel="noopener noreferrer">到底三段式版本号是什么？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <div class="custom-block tip"><p class="custom-block-title">编写实例</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;my-first-module&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;这个是一个示例模块打包教程&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div> <h4 id="depends"><a href="#depends" class="header-anchor">#</a> - depends</h4> <ul><li>类型：map of string（例如 <code>{&quot;foo&quot;:&quot;bar&quot;,&quot;baz&quot;:&quot;zoo&quot;}</code>）。</li> <li>含义：模块的依赖关系和版本依赖声明。</li></ul> <p>此处用作模块的依赖检测，假设模块 <code>foo</code> 依赖模块 <code>bar</code> 的 1.x 版本但是不兼容 <code>bar</code> 的 2.x 版本，可以像 Composer 的 <code>require</code> 一样编写版本依赖：<code>^1.0</code>。也可以使用 <code>~</code>、<code>&gt;=</code>、<code>*</code> 这些与 Composer 包管理相同逻辑的版本依赖关系，详见 <a href="https://docs.phpcomposer.com/01-basic-usage.html#Package-Versions" target="_blank" rel="noopener noreferrer">Composer - 包版本<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <div class="custom-block tip"><p class="custom-block-title">编写实例</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;这个是一个示例模块打包教程&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;depends&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
		<span class="token property">&quot;bar&quot;</span><span class="token operator">:</span> <span class="token string">&quot;^1.0&quot;</span><span class="token punctuation">,</span>
		<span class="token property">&quot;bsr&quot;</span><span class="token operator">:</span> <span class="token string">&quot;*&quot;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></div> <h4 id="light-cache-store"><a href="#light-cache-store" class="header-anchor">#</a> - light-cache-store</h4> <ul><li>类型：array of string（例如 <code>[&quot;foo&quot;,&quot;bar&quot;]</code>）。</li> <li>含义：打包模块时要储存的持久化 LightCache 键名列表。</li></ul> <p>这里需要配合 LightCache 使用，如果你有一些需要全局缓存的数据，例如动态配置项，比如群服务状态列表，可以先使用 LightCache 存储并使用 <code>addPersistence()</code> 持久化，此后在使用模块打包时编写此配置项。</p> <p>我们假设在项目模块中使用到了 <code>group-status</code> 这一个 LightCache，那么只需要写 <code>light-cache-store</code> 配置项，在模块打包时就会将持久化的数据也打包到 phar 模块包内。</p> <div class="custom-block tip"><p class="custom-block-title">编写实例</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;这个是一个示例模块打包教程&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;light-cache-store&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token string">&quot;group-status&quot;</span>
	<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div> <h4 id="global-config-override"><a href="#global-config-override" class="header-anchor">#</a> - global-config-override</h4> <ul><li>类型：string | false。</li> <li>含义：解包时是否需要手动编辑全局配置（<code>global.php</code>）。</li></ul> <p>这里如果写 string 类型的，那么就是相当于在解包时会提示此处的内容，内容推荐填写要求解包模块用户需要编辑的项目，比如 「请将 static_file_server 的 status 改为 true，以便使用静态文本功能」。</p> <p>如果是 false，那么和不指定此参数效果是一样的，无需用户修改 global.php。</p> <div class="custom-block tip"><p class="custom-block-title">编写实例</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;这个是一个示例模块打包教程&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;global-config-override&quot;</span><span class="token operator">:</span> <span class="token string">&quot;请将 static_file_server 的 status 改为 true&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div> <h4 id="allow-hotload"><a href="#allow-hotload" class="header-anchor">#</a> - allow-hotload</h4> <ul><li>类型：bool。</li> <li>含义：是否允许用户无需解压直接加载模块包文件（phar）。</li></ul> <p>当此项为 true 时，可以将模块包直接放入 <code>zm_data/modules</code> 文件夹下，然后将 <code>global.php</code> 中的 <code>module_loader</code> 项中的 <code>enable_hotload</code> 改为 true，启动框架即可加载。</p> <div class="custom-block tip"><p class="custom-block-title">编写实例</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;这个是一个示例模块打包教程&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;allow-hotload&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div> <div class="custom-block warning"><p class="custom-block-title">注意</p> <p>如果使用允许热加载，那么模块包中的配置最好不要有 <code>global-config-override</code> 和 <code>light-cache-store</code>，以此来达到最正确的效果，一般热加载更适合 Library（库）类型的模块。</p></div> <h4 id="zm-data-store"><a href="#zm-data-store" class="header-anchor">#</a> - zm-data-store</h4> <ul><li>类型：array of string（例如 <code>[&quot;foo&quot;,&quot;bar&quot;]</code>）。</li> <li>含义：打包时要添加到模块包内的 <code>zm_data</code> 目录下的子目录或文件。</li></ul> <p>其中项目必须是相对路径，不能是绝对路径，且必须是在配置项 <code>zm_data</code> 指定的目录（默认会在框架项目的根目录下的 <code>zm_data/</code> 目录。</p> <p>我们假设要打包一个 <code>{zm_data 目录}/config/</code> 目录及其目录下的文件，和一个 <code>main.png</code> 文件，下方是实例。</p> <div class="custom-block tip"><p class="custom-block-title">编写实例</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
	<span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;这个是一个示例模块打包教程&quot;</span><span class="token punctuation">,</span>
	<span class="token property">&quot;zm-data-store&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token string">&quot;config/&quot;</span><span class="token punctuation">,</span>
		<span class="token string">&quot;main.png&quot;</span>
	<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></div> <p>在打包时框架会自动添加这些文件到 phar 插件包内，到解包时，会自动将这些文件释放到对应框架的 <code>zm_data</code> 目录下。</p> <h2 id="打包模块命令"><a href="#打包模块命令" class="header-anchor">#</a> 打包模块命令</h2> <p>编写配置文件 <code>zm.json</code> 后，就可以被框架正常识别为模块形式，你也可以使用对无需打包的模块进行配置以进行分类管理。</p> <h3 id="module-list"><a href="#module-list" class="header-anchor">#</a> module:list</h3> <p>使用 list 命令可以列出炸毛框架检测到配置文件或打包好的模块。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ ./zhamao module:list
[foo]
        类型: source
        版本: 1.0.0
        描述: 示例模块打包文件
        目录: src/Module/Example
没有发现已打包且装载的模块！
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>其中 <code>[ ]</code> 内为识别出来的模块名称，由上方用户编写的 <code>zm.json</code> 定义，类型为 <code>source</code> 是源码形式，也就是指定了 <code>zm.json</code> 形式的模块，目录为模块所在子目录。</p> <p>我们假设打包上方定义的 <code>foo</code> 模块，使用下方命令 <code>module:pack</code> 即可。</p> <h3 id="module-pack"><a href="#module-pack" class="header-anchor">#</a> module:pack</h3> <p>使用 pack 命令可以将配置好的模块打包为 <code>xxx.phar</code> 文件并转移或发布给他人。</p> <p>我们假设打包模块脚手架的默认模块 <code>src/Module/Example</code> 下面的模块源码和附带一个 <code>zm_data</code> 目录下的文件（我们就随便打包一下 Swoole 的输出日志吧）。<code>zm.json</code> 文件内容如下：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;description&quot;</span><span class="token operator">:</span> <span class="token string">&quot;示例模块打包文件&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.0.0&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;allow-hotload&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token property">&quot;zm-data-store&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;crash/swoole_error.log&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>然后输入命令：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>$ ./zhamao module:pack foo
[15:07:11] [I] 模块输出文件：/root/zhamao-framework/zm_data/output/foo_1.0.0.phar
[15:07:11] [S] 打包完成！
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>如果提示文件夹不存在，请先手动创建文件夹：<code>mkdir /path/to/your/zm_data/output</code></p> <p>在打包后，你将获得一个 <code>foo_1.0.0.phar</code> 的文件。</p> <blockquote><p>如果你没有在 <code>zm.json</code> 中指定 <code>version</code>，那么输出的 phar 文件是不会带版本号的。</p></blockquote> <p>打包后的 phar 内将包含：</p> <ul><li>Hello.php</li> <li>zm.json</li> <li>crash/swoole_error.log</li> <li>必要的框架热加载以及解包需要的配置信息</li></ul> <h2 id="打包命令"><a href="#打包命令" class="header-anchor">#</a> 打包命令</h2> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># ./zhamao 和原先的 vendor/bin/start 是完全一致的</span>
./zhamao module:pack <span class="token operator">&lt;</span>module-name<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>例如，打包上面的名叫 foo 的模块：<code>./zhamao module:pack foo</code>。</p> <p>打包命令执行后，将会在 <code>zm_data</code> 下的 <code>output</code> 目录输出一个 phar 文件。如果你指定了 <code>version</code> 参数，那么文件名将会是 <code>${name}_${version}.phar</code>，如果没有指定版本，那么只会有 <code>${name}.phar</code>，同时如果文件已经存在，将覆盖写入。</p> <h2 id="查看模块信息命令"><a href="#查看模块信息命令" class="header-anchor">#</a> 查看模块信息命令</h2> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>./zhamao module:list
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>通过此命令可以查看模块相关的信息，如未打包但已配置的模块信息等。</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/zhamao-robot/zhamao-framework/edit/master/docs/component/module/module-pack.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">3/17/2022, 1:53:06 AM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/component/http/route-manager.html" class="prev"><i aria-label="icon: left" class="anticon anticon-left"><svg viewBox="64 64 896 896" focusable="false" data-icon="left" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 0 0 0 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"></path></svg></i>
        HTTP 路由管理
      </a></span> <span class="next"><a href="/component/module/module-unpack.html">
        模块解包
        <i aria-label="icon: right" class="anticon anticon-right"><svg viewBox="64 64 896 896" focusable="false" data-icon="right" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M765.7 486.8L314.9 134.7A7.97 7.97 0 0 0 302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 0 0 0-50.4z"></path></svg></i></a></span></p></div> </main> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.74588e53.js" defer></script><script src="/assets/js/2.75938045.js" defer></script><script src="/assets/js/37.34442c2f.js" defer></script>
  </body>
</html>